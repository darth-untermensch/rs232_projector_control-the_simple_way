# The musings of a chaotic mind
My journey started by looking for add-ons in the default KODI repositories, built to control projectors or at least to grant a means of pushing data up a serial line. I found Fredrik Eriksson's Projector Control for KODI add-on (https://github.com/fredrik-eriksson/kodi_projcontrol). It seemed like the ideal solution until I read the support list... no BENQ. It also seemed to do a LOT, which is great, except all I want right now is power on and off. And adding support for BENQ seemed like too much of a hassle. If your projector is on the list though - go ahead and use it, it's a proper add-on. What I'm doing here is amateur hour.

I couldn't find much by way of raw serial communication accessible through KODI (it's a media centre after all), so instead I focused on the host OS.
LibreELEC is set up in a fairly locked down way. There's no OS-level package manager, most of the GNU tools aren't available - when they say "just enough" they mean it! You do however get SSH, some basic navigation tools and nano.

This is where the unix architecture becomes beneficial. It presents basically every device as a file you can just write to. That includes the USB RS232 interface. It's just a tty terminal as far as the kernel is concerned, so anything you echo into it will just be sent up the serial line.

Bidirectional communication can get a bit trickier (the BENQ projectors send feedback confirming power state, etc. Handy for more sophisticated work) from within the shell, but we're not trying to do anything too complicated here - all I want (for now) is to power it on and clear the lamp hour warnings (I'll replace it when it fails. Sue me!) when libreELEC boots up and to switch it off when it shuts down.

As far as libreELEC cares, anything you shove into the autostart.sh file (location /storage/.config/) will be executed during startup. Wiki says the network stack is up when that happens, so my guess is it runs last or thereabouts. It's PERFECT! The wiki also offers some guidelines on how to structure the entries so they don't hold up the rest of the start-up sequence, it's worth a read.

Shutdown is more complicated though. There's an equivalent file (autostop.sh?) which runs before the rest of the shutdown sequence, but in perusing the documentation I found it a bit limiting for the following reason - it runs regardless of why the system is being shut down, which means it could well run when a restart is required. That's just not peachy as far as projectors go though, HID lamps (like those in DLP projectors) do NOT like power cycles. Striking the arc shortens the lamp life much more than hours of operation. So clearly we're in a doozy of a pickle here...

The other option for shutdown commands is in the shutdown.sh script (same directory). This one is an earlier addition and runs after the bulk of the shutdown sequence (no network stack, but we don't need that anyway). Using the file's structure from the wiki it's possible to run commands depending on what the OS is actually doing. It distinguishes between halt, power off and reboot, which is perfect - we want the projector off on power off only, and definitely not during reboot.

That's the architecture sorted - the only bits left are the actual code. I want this done in shell script. It's the simplest and probably most universal way to get the job done. It has its limitations, but we're not trying to do too much here, so I'm fine with those.
The serial commands were easy enough to find, I even went as far as to pluck them out of the PDFs and CSV them for easy sorting/searching/filtering. They live in the w1070_rs232.csv file, though I'm sure they're not specific to the 1070. The only confusing part is the carriage return at the start and end. Don't send \<CR>, echo responds to \r instead (see scripts).
Sending data up the serial line without special tools is as simple as echo -en "command" > interface. In this case, it's a USB serial interface presented as ttyUSB0, so echo -en '\r*pow=on#\r' > /dev/ttyUSB0 will switch the unit on. That's it, no C, no python, no other people's code that can break yours, just a shell one-liner that doesn't try to do too much.

There are some potential pitfalls to look out for though. The big one are serial settings. The projector seems to work fine with the linux default configuration (in libreELEC and fedora anyway), except its default baud rate is 115200, whereas the libreELEC default is 9600. Normally that's not an issue, stty can adjust it accordingly, except libreELEC doesn't come with stty or any of the other serial interface tools. Nor does it have a package manager to install them. We're stuck at 9600 baud and you need to adjust your projector accordingly. If you can't access the menu for whatever reason, connect using a laptop and send *baud=9600#. I like to use tio on mine, it shows everything sent back by the projector, but you could just echo it over like in the scripts.
